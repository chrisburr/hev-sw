{% set fan_active = True %}
{% extends 'base.html' %}

{% block fan_classes %}
{% endblock %}

{% block content %}
<main>

  <div class="container-fluid">
    <!--<h1 class="mt-4">Info</h1> !-->
    <div class = "row">
      <div class = "col-md-7 py-0">
	<div class="row col-center pb-1">
	<select id='chart_variables' multiple="multiple" class="form-select">
		<option value='pressure_air_supply' selected>Air (supply)</option>
		<option value='pressure_air_regulated' selected>Air (regulated)</option>
		<option value='pressure_o2_supply' selected>O2 (supply)</option>
		<option value='pressure_o2_regulated' selected>O2 (regulated)</option>
        <option value='pressure_buffer' selected>Buffer</option>
        <option value='pressure_inhale' selected>Inhale</option>
		<option value='temperature_buffer' selected>temperature_buffer</option> 
		<option value='pressure_patient' selected>Patient</option>
		<option value='pressure_diff_patient' selected>Patient (diff)</option>
		
		<!-- VICTOR test -->
		<option value='pressure_buffer' selected>Pressure</option>
		<option value='pressure_inhale' selected>Flow</option>
		<option value='temperature_buffer' selected>Volume</option>



	</select>
        <input class="form-button" type="button" value="Submit" onclick="updateChartType()">
	</div>

	<div class="row">
          <div class="col-md-12">
            <div class="card mb-6">
              <!--<div class="card-chart-header small ">Variable number 1</div>-->
              <div class="card-body px-0 py-0 tiny"><canvas id="pressure_air_supply" width="100%" height="80px"></canvas></div>
            </div>
          </div>
	</div>
      </div>
    
      <div class = "col-md-5 py-0 px-0 mr-0 pl-1">
	<div class="row">
	  <div class="col-xl-4 px-1 py-0 mr-0">
	    <div class="card bg-primary text-dark mb-2">
              <div class="card-header d-flex align-items-center justify-content-between py-1 min-height-1b">
		      <a class="small text-dark stretched-link col-center" href="#">Mode</a>
              </div>
              <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id="fsm_state">IDLE</span></div>
	    </div>
	  </div>
	  
	  <div class="col-xl-4 px-1 py-0 mr-0">
	    <div class="card bg-primary text-dark mb-2">
              <div class="card-header d-flex align-items-center justify-content-between py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">FIO<sub>2</sub></a>
              </div>
              <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_air_supply">000.00</span>cmH2O</div>
	    </div>
	  </div>

	  <div class="col-xl-4 px-1 py-0 mr-0">
	    <div class="card bg-primary text-dark mb-2">
	      <div class="card-header d-flex align-items-center justify-content-between py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">Peak Pressure</a>
	      </div>
	      <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id="pressure_air_regulated">000.00</span>cmH2O</div>
	    </div>
	  </div>
	  
	  <div class="col-xl-4 px-1 py-0 mr-0">
	    <div class="card bg-primary text-dark mb-2">
	      <div class="card-header d-flex align-items-center justify-content-between py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">Plateau Pressure</a>
	      </div>
	      <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_o2_supply">000.00</span>cmH2O</div>
	    </div>
	  </div>	  
	  <div class="col-xl-4 px-1 py-0 mr-0">
	    <div class="card bg-primary text-dark mb-2">
	      <div class="card-header d-flex align-items-center justify-content-between py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">Mean Pressure</a>
	      </div>
	      <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_o2_regulated">000.00</span>cmH2O</div>
	    </div>
	  </div>	  	  
	  
	  <div class="col-xl-4 px-1 py-0">
	    <div class="card bg-primary text-dark mb-2">
	      <div class="card-header d-flex align-items-center justify-content-between py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">PEEP</a>
	      </div>
	      <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_buffer">000.00</span> cmH2O</div>
	    </div>
	  </div>
	  
	</div>
	
	<div class="row">
	  <div class="col-xl-4 px-1 py-0">
	    <div class="card bg-primary text-dark mb-2">
              <div class="card-header d-flex align-items-center justify-content-between small py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">Tidal Volume Inhaled</a>
              </div>
              <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_inhale">000.00</span> mL</div>
	    </div>
	  </div>
	  <div class="col-xl-4 px-1 py-0">
	    <div class="card bg-primary text-dark mb-2">
              <div class="card-header d-flex align-items-center justify-content-between small py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">Tidal Volume Exhaled</a>
              </div>
              <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_patient">000.00</span> mL</div>
	    </div>
	  </div>
	  <div class="col-xl-4 px-1 py-0">
	    <div class="card bg-primary text-dark mb-2">
              <div class="card-header d-flex align-items-center justify-content-between py-1 small min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">Minute Volume Inhaled</a>
              </div>
              <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_diff_patient">000.00</span> mL</div>
	    </div>
	  </div>
	</div>
	
	<div class="row">
	  <div class="col-xl-4 px-1 py-0">
	    <div class="card bg-primary text-dark mb-2">
              <div class="card-header d-flex align-items-center justify-content-between py-1 small min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">Minute Volume Exhaled</a>
              </div>
              <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_inhale">000.00</span> mL</div>
	    </div>
	  </div>
	  <div class="col-xl-4 px-1 py-0">
	    <div class="card bg-primary text-dark mb-2">
              <div class="card-header d-flex align-items-center justify-content-between py-1 min-height-1b">
		<a class="small text-dark stretched-link col-center" href="#">I:E Ratio</a>
              </div>
	      
              <div class="card-body px-1 py-1 tiny"><span class = "reading-main" id = "pressure_patient">000.00</span> </div>
	    </div>
	  </div>
	  <div class="col-xl-4 px-1 py-0">
	  </div>
	</div>
	<div class = "row no-gutters ml-auto mr-auto py-2">
	</div>
      </div>
    </div>
  </div>
</div>
</main>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/Chart-plot.js') }}"></script>
<script type=text/javascript>
  function toggle_lock_settings() {
  setTimeout(function(){
  var x = document.getElementsByClassName("form-control");
  var i;
  if ( x.length > 0 && x[0].readOnly == true ){
  for (i = 0; i < x.length; i++) {
		  if (x[i].id != "form_submit"){
		     x[i].readOnly = false;
		  }
		  else{
		     x[i].disabled=false;
		  }
		  var submit = document.getElementById("form_submit");
		  submit.disabled=false;
		  }
          var el = document.getElementById("path-locked");
          el.classList.add("transparent");
		  var el2 = document.getElementById("path-unlocked");
		  el2.classList.remove("transparent");

		  } else {
		  for (i = 0; i < x.length; i++ ) {
			if (x[i].id != "form_submit"){
			x[i].readOnly = true;
			}
		    else {x[i].disabled=true; }
				  
		    var submit = document.getElementById("form_submit");
		    submit.disabled=true;
		    var el = document.getElementById("path-unlocked");
		    el.classList.add("transparent");
		    var el2 = document.getElementById("path-locked");
		    el2.classList.remove("transparent");		  
		  }
		  }
	500})
    }				 
</script>

<script type=text/javascript>
	function update_variables() {
	$.getJSON("live-data",
		function (data) {
<!--
		document.getElementById("pressure_buffer").innerHTML = data.pressure_buffer.toPrecision(5);
		document.getElementById("pressure_inhale").innerHTML = data.pressure_inhale.toPrecision(5);
	//document.getElementById("temperature_buffer").innerHTML = data.temperature_buffer.toPrecision(5);
		document.getElementById("pressure_air_supply").innerHTML = data.pressure_air_supply.toPrecision(5);
		document.getElementById("pressure_air_regulated").innerHTML = data.pressure_air_regulated.toPrecision(5);		
		document.getElementById("pressure_o2_supply").innerHTML = data.pressure_o2_supply.toPrecision(5);
		document.getElementById("pressure_o2_regulated").innerHTML = data.pressure_o2_regulated.toPrecision(5);
		document.getElementById("pressure_patient").innerHTML = data.pressure_patient.toPrecision(5);
		document.getElementById("pressure_diff_patient").innerHTML = data.pressure_diff_patient.toPrecision(5);		
		document.getElementById("fsm_state").innerHTML = data.fsm_state.toPrecision(1);
		//document.getElementById("version").innerHTML = data.version.toPrecision(1); //Commented because not included in the html part
-->
		document.getElementById("pressure_buffer").innerHTML = (data.pressure_buffer).toFixed(2);
		document.getElementById("pressure_inhale").innerHTML = (data.pressure_inhale).toFixed(2);
//document.getElementById("temperature_buffer").innerHTML = (data.temperature_buffer).toFixed(2);
		document.getElementById("pressure_air_supply").innerHTML = (data.pressure_air_supply).toFixed(2);
		document.getElementById("pressure_air_regulated").innerHTML = (data.pressure_air_regulated).toFixed(2);		
		document.getElementById("pressure_o2_supply").innerHTML = (data.pressure_o2_supply).toFixed(2);
		document.getElementById("pressure_o2_regulated").innerHTML = (data.pressure_o2_regulated).toFixed(2);
		document.getElementById("pressure_patient").innerHTML = (data.pressure_patient).toFixed(2);
		document.getElementById("pressure_diff_patient").innerHTML = (data.pressure_diff_patient).toFixed(2);		
		document.getElementById("fsm_state").innerHTML = (data.fsm_state).toFixed(2);
		//document.getElementById("version").innerHTML = (data.version).toFixed(2); //Commented because not included in the html part
		}
	);
	}
	setInterval('update_variables()', 1000);

  </script>
  


	{% endblock %}
	{% block body_scripts %}

        <script src="{{ url_for('static', filename='js/Chart-plot.js') }}"></script>
	{% endblock %}
